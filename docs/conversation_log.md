# Vault Alchemist — 仕様決定会話ログ
> 「なぜこの設計を選んだか」の意思決定の記録。
>
> 📖 **NotebookLM で読む**: https://notebooklm.google.com/notebook/3f82472f-8f3a-48f5-b8e3-cf041ebc734e

---

## 2026-02-26 — セッション開始

### 背景
途中まで書かれた仕様書（`途中まで（編集NG）.md`）をベースに、  
**Vault Alchemist の完成版仕様書を会話を通じて一緒に作る**セッション。

---

## 決定①：技術スタックの統一

**Q（AI）**: serviceのバックエンド言語はPythonとTypeScript（Node.js）どちらにしますか？

---

**ユーザーの視点**:
> 「僕は言語を覚える気はない。今の時代にEXCELを使うのに算盤から練習しようって感じ。  
> でも最終的に一般的な人がPCで使えるようにしたい。TypeScriptじゃないとダメ？」

**重要な発見（AIの整理）**:
- Obsidianプラグインは**TypeScript固定**（Obsidianのルールで選択不可）
- serviceの言語はPython・TypeScriptどちらでも**一般ユーザーへの配布に影響しない**（どちらも `.app`/`.exe` にまとめられる）
- 「AIに書かせる」前提では「バグが起きにくいか」が選択軸

**決定**:  
→ **TypeScript（Node.js）に統一**

**理由**:
1. プラグインとserviceで「データの形（型）」を共有できる（`shared/` フォルダが活きる）
2. AI主体で開発するとき、言語統一でバグが起きにくい
3. 一般ユーザーへの配布はどちらでも可能なので、統一のメリットだけ取れる

---

## 決定②：ファイル管理方針

**Q（ユーザー）**:  
> 「仕様書は会話の中で一緒に作りたい。会話も後でNotebookLMに載せたいので別ファイルで保存してほしい。」

**決定**:
- `docs/spec.md` — 設計図（決まったことを随時追記）
- `docs/conversation_log.md` — この会話の意思決定ログ（本ファイル）

---

---

## 決定③：AIプロバイダ構成

**Q（AI）**: AIプロバイダはOpenAIを主力にしますか？

**ユーザーの回答**:
> 「OpenAIをAPIとOAuthでの利用と、xAIも使えるようにしたい。」

**決定**:
- **主力**: OpenAI（API接続 + OAuth接続の両対応）
- **探索用**: xAI / Grok（オプション。未設定でも全機能が動く）

**理由**:
- OpenAI は API の実績・安定性・日本語対応が最も高い
- OAuth 接続でAPIキーなしでも使える体験を提供 → 一般ユーザーへの敷居を下げる
- xAI は X（旧Twitter）のリアルタイム情報が強み。探索用途として位置づけ

---

## 決定④：開発フロー

**ユーザーの意向**:
> 「仕様書や手順書を作って、実際の作業はGitHubにあげてから始める予定。」

**決定**:
- spec.md → tasks.md 完成 → GitHub push → 実装開始
- **GitHubリポジトリ構成**: 未確定（会話継続中）

---

---

## 決定⑤：配布方針（段階的アプローチ）

**Q（AI）**: serviceの配布をElectronアプリにしますか？

**ユーザーの意向**:
> 「まずはコアユーザー層に刺さるような形にしてから徐々に一般化させたほうが現実的だと思うけど、どう思う？」

**AIの見解**: 完全同意。理由：
- Obsidianユーザー自体がすでにリテラシーの高いコアユーザー層
- Electron化は重い投資。需要が証明されてから行うべき
- 「刺さる人に刺さる」ところから始めて徐々に拡大するのが現実的

**決定**:

| 段階 | 対象 | 配布方法 |
|---|---|---|
| Step 1 | 開発者・自分 | `npx` or `git clone` |
| Step 2 | コアユーザー（Obsidian民） | `npm install -g` + README |
| Step 3 | 一般ユーザー | インストーラ or Electron（需要確認後） |

**プラグインの配布**:
- まず**サイドロード**（GitHub経由）で公開
- 成熟してからコミュニティプラグインとして申請

---

---

## 決定⑥：リポジトリ構成・OSS方針

**ユーザーの意向**:
> 「開発段階から多くの人が関わった方がいい。使ってからドヤって広げてくれるから、オープンにしたい。」
> 「誰でも今はAIで作業してるので、AIが作業しやすいことが一番大事かもしれない。」

**決定**:
- リポジトリ名: **`vault-alchemist`**（GitHub OSS公開）
- 構成: **Monorepo**（plugin / service / shared / docs を1リポジトリで管理）
- 公開方針: オープンソース・コミュニティドリブン
- ドキュメント: `README.md`（英語）+ `README.ja.md`（日本語）の2ファイル体制

**Monorepo を選んだ核心理由**:
> AIが作業しやすいことを最優先にした結果、自然にMonorepoが最適解になった。
> - AIは1リポジトリで全体を把握できる
> - 分割リポにするとAIがコード間の関係を見失いやすい
> - TypeScriptの型共有も自然にできる

---

---

## 決定⑦：事業モデル・ライセンス・タスク粒度

**ユーザーの意向**:
> 「一発当てて次の開発にもっとお金使えるようになりたい。」
> 「企業利用者向けに一部有料、APIを用意できない人には広告等で回すことも検討。」
> 「1作業10分で確実に1つずつ進められる形がいい。」

**決定①：ライセンス → MIT License**
- 理由: コミュニティ最大化を優先。収益はライセンスではなくサービスから得る設計なので、MIT縛りは不要。

**決定②：事業モデル → Open Core**
| 層 | 対象 | 内容 |
|---|---|---|
| 無料（OSS） | 自前APIキー持ち | 全機能が無料 |
| Layer A | APIキー不要の層 | 月額課金 or 広告でクレジット獲得（選択制） |
| Layer B（将来） | 企業・チーム | チーム機能・管理者・SLA |

**決定③：タスク粒度 → 1タスク10分以内**
- 完了条件を必ず明記
- 依存関係を明示
- 作業者が途中で変わっても再開できる形に

---

- Project Map（ディレクトリ構成の詳細）

---

## 決定⑧：Project Map・service自動起動・UI文言

### Project Map
```
vault-alchemist/
├── plugin/      🧩 Obsidianの中に入るUI・操作部分
├── service/     🏭 PCの裏で動く処理エンジン
├── shared/      🔗 共通の型定義（両方からimport）
├── docs/        📄 設計図・手順書（今ここ）
├── README.md    英語説明
├── README.ja.md 日本語説明
└── LICENSE      MIT
```

### service自動起動設計（致命的弱点の克服）

**問題提起**（AI）：serviceが起動していないと動かない → ユーザー体験のボトルネック

**ユーザーの問い**:
> 「プラグイン起動時にServiceが動いてるか動いてないかにかかわらず、クリックして起動したのと同じ状態にできないの？」

**解決**:
- ObsidianはElectron製 → プラグインからNode.js機能が使える
- serviceをプラグインフォルダに同梱 → Obsidian起動時に自動で裏起動
- **「プラグインを入れるだけで全て動く」設計に確定**

### UI文言ルール

**ユーザーの意見**:
> 「『バックグラウンドプロセスを起動します』は仰々しい。『作業をバックグラウンドで行います』の方が伝わりやすい。」

**決定**:
- 初回起動時: 「Vault Alchemistは、あなたのじゃまにならないよう、裏側で静かに動いています 🌙」
- 常時ステータス: 「Vault Alchemistは、裏側で静かに動いています 🌙」
- 原則: **技術用語を使わず、体験を言葉にする**

---

## 決定⑨：Persona公開モード（Phase 7）

**ユーザーのビジョン**:
> 「MCP等を使って、ユーザーが一部のデータを外側に出せるようにしてほしい。
> イーロン・マスクが自分の人格とロケットについての項目を外に出すと、AIを通じて、まるでイーロンの火星にいく構想を一緒に語り合えるようになる。
> 政治家も国民との対話に使えると思う。多くの人がお互いを理解しあうために、このプラグインを育てたい。」

**一貫性チェック（AI指摘）**:
Core Definitionの「ローカル優先」と方向が逆に見えるが、矛盾しない:
> 「ローカル優先」= デフォルトは出ない。**意図して公開した場合のみ**出る。

**「Human X」vs「AI-X」の哲学**:
> 「イーロンとイーロンAIは別なんじゃない？」（ユーザー）
> → **最初から別物として明示する設計**に確定。
> 完璧ななりすまし防止は目指さない。「明確な区別」を設計に組み込む。ハルシネーションと同じ考え方。

**決定**: Phase 7として仕様に追加。`features.persona_public=false`（デフォルト非公開）

---

## 決定⑩：spec.mdの詳細マージ・tasks.md作成

**背景**:
> 「元の仕様書とボリュームが全然違う。前回Geminiが大幅に簡略化したので、今Google Antigravityで書いている。」

**対処**:
- 元草稿（途中まで.md）から抜け漏れ全セクションをspec.mdに追記
- 追記内容: 初期セットアップ / Automation Profile / タイトル最適化 / フォルダ整理 / 鮮度管理 / MCP設計 / Webクリッパー / Google Drive同期 / スケジューラ / コスト管理 / UI全画面詳細 / Work Planning / ローカルLLM等
- `DRAFT_REFERENCE.md` を作成し、元草稿を「編集不可の参照用原本」として位置づけ

**tasks.md作成**: Phase 1（A-MVP）全30タスクを1タスク10分以内・完了条件付きで定義

---

## 決定⑪：READMEを哲学書として書き直し

**ユーザーの意向**:
> 「リードミーは、単なる仕様書じゃなくて哲学書。長くなってもいいからしっかりしたのを書いてほしい。」

`README.md`（英語）・`README.ja.md`（日本語）を全面書き直し。

最終セクション「作者から、ともに歩くあなたへ」:
> 「僕はどこにでもいる卑しい人間だ。欲もでるし、意地汚さや卑怯さも当然に持ち合わせている。だからこそ、コアな自分の価値観にいつでも戻れるよう、この仕様を作り込んだ。ブレる時は指摘してほしい。」
> 「人類とAIがともに歩める未来のために。人と人、人とAIが相互にメンテナンスができる未来のために。」

---

## 🚀 GitHub公開完了（2026-02-26）

- **リポジトリ**: https://github.com/matsulinks/vault-alchemist
- **ライセンス**: MIT
- **公開ファイル**: spec.md / tasks.md / conversation_log.md / README（日英）/ 元草稿 / LICENSE
- **非公開（gitignore）**: 会話歴.md / 仕様書の方針.md / agent-progress.md

---

## このセッションで確定した全決定事項

| # | 決定内容 |
|---|---|
| ① | 言語: TypeScript統一（プラグイン・service・shared） |
| ② | ファイル管理: spec.md + conversation_log.md |
| ③ | AI: OpenAI（主力・API+OAuth）+ xAI（探索・オプション） |
| ④ | 開発フロー: 仕様→tasks.md→GitHub→実装 |
| ⑤ | 配布: 段階的（npx→npm global→Electron） |
| ⑥ | リポジトリ: vault-alchemist / Monorepo / OSS |
| ⑦ | ライセンス: MIT / 事業: Open Core / タスク粒度: 10分 |
| ⑧ | Project Map確定 / service自動起動 / UI文言ルール |
| ⑨ | Persona公開モード（Phase 7）追加 |
| ⑩ | spec.md完全版マージ / tasks.md（30タスク）作成 |
| ⑪ | README哲学書化 / 作者のメッセージ追加 |
| ⑫ | GitHub公開完了（matsulinks/vault-alchemist） |
